# üî¨ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ê–£–î–ò–¢ –ü–†–û–ï–ö–¢–ê VPN CONNECT v2.2.0

**–î–∞—Ç–∞:** 18 –¥–µ–∫–∞–±—Ä—è 2025, 14:44 MSK  
**–ê—É–¥–∏—Ç–æ—Ä:** Lead Developer  
**–í–µ—Ä—Å–∏—è:** v2.2.0

---

## üìä EXECUTIVE SUMMARY

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è               | –û—Ü–µ–Ω–∫–∞    | –°—Ç–∞—Ç—É—Å                       |
| ----------------------- | --------- | ---------------------------- |
| **TypeScript Build**    | ‚úÖ        | –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫     |
| **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**         | üü¢ 8.5/10 | Serverless, —á–∏—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**        | üü¢ 8/10   | IP –ø—Ä–æ–≤–µ—Ä–∫–∞, JWT, rate limit |
| **UX Flow**             | üü¢ 8/10   | 3 —à–∞–≥–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è      |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**        | üü¢ 9/10   | –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è          |
| **YooKassa Compliance** | ‚úÖ        | –û—Ñ–µ—Ä—Ç–∞, privacy –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç |

**–û–±—â–∏–π –±–∞–ª–ª: 8.3/10** ‚≠ê

---

## ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û

### 1. Telegram Bot (`api/bot/webhook.ts`)

- [x] 7 –∫–Ω–æ–ø–æ–∫ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏
- [x] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π base URL
- [x] –ö–Ω–æ–ø–∫–∞ VPN –≤–µ–¥—ë—Ç –Ω–∞ –ª–µ–Ω–¥–∏–Ω–≥ —Å `tg_id`
- [x] –ö–Ω–æ–ø–∫–∞ –æ–ø–ª–∞—Ç—ã –≤–µ–¥—ë—Ç –Ω–∞ –ª–µ–Ω–¥–∏–Ω–≥ —Å `action=pay`
- [x] –ö–Ω–æ–ø–∫–∞ –æ—Ñ–µ—Ä—Ç—ã (`/offer.html`)
- [x] –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º (iOS, Android, APK, Desktop)
- [x] –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏

### 2. User Creation (`api/create-user/index.ts`)

- [x] Vercel KV Rate Limiting (—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π)
- [x] Trial Storage –≤ KV
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram ID
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ trial
- [x] JWT —Ç–æ–∫–µ–Ω –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- [x] –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ª–æ–≥–≥–µ—Ä

### 3. Payment (`api/payment/create.ts`)

- [x] telegramId —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ metadata
- [x] planDuration —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ metadata
- [x] –î–µ—Ñ–æ–ª—Ç amount = 99‚ÇΩ
- [x] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π return_url
- [x] Rate limiting

### 4. Payment Webhook (`api/payment/webhook.ts`)

- [x] YooKassa IP verification
- [x] PaymentStorage (Vercel KV)
- [x] –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π

### 5. Smart Router (`api/go/[token].ts`)

- [x] –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (iOS/Android/Windows/Mac)
- [x] Deep links –¥–ª—è Hiddify/Streisand
- [x] Subscription URL –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- [x] QR –∫–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- [x] Fallback —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### 6. Landing Page (`public/index.html`)

- [x] SEO meta tags (YouTube, Instagram, Netflix, etc.)
- [x] Open Graph tags
- [x] Keywords –¥–ª—è –ø–æ–∏—Å–∫–æ–≤–∏–∫–æ–≤
- [x] –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –±–∞–Ω–∫–æ–≤

### 7. Legal Documents

- [x] `offer.html` ‚Äî –ø–æ–ª–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä –æ—Ñ–µ—Ä—Ç—ã
- [x] `privacy.html` ‚Äî –ø–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
- [x] –ò–ü —Ä–µ–∫–≤–∏–∑–∏—Ç—ã (–ò–ù–ù: 520500573503)

### 8. Vercel Configuration (`vercel.json`)

- [x] URL rewrites –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Ä–æ—É—Ç–æ–≤
- [x] CORS headers
- [x] Function timeouts (30s –¥–ª—è webhook)

---

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

```
BotiNstsgram/
‚îú‚îÄ‚îÄ api/                         # Serverless Functions
‚îÇ   ‚îú‚îÄ‚îÄ bot/webhook.ts           # ‚úÖ Telegram –±–æ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ create-user/index.ts     # ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —é–∑–µ—Ä–æ–≤ + trial
‚îÇ   ‚îú‚îÄ‚îÄ payment/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create.ts            # ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ webhook.ts           # ‚úÖ YooKassa webhook
‚îÇ   ‚îú‚îÄ‚îÄ go/[token].ts            # ‚úÖ Smart Router
‚îÇ   ‚îú‚îÄ‚îÄ config/[token].ts        # ‚úÖ JSON config
‚îÇ   ‚îú‚îÄ‚îÄ link/[token].ts          # ‚úÖ VLESS URI
‚îÇ   ‚îú‚îÄ‚îÄ sub/[token].ts           # ‚úÖ Subscription
‚îÇ   ‚îú‚îÄ‚îÄ health/index.ts          # ‚úÖ Health check
‚îÇ   ‚îî‚îÄ‚îÄ users/[uuid]/traffic.ts  # ‚úÖ Traffic stats
‚îÇ
‚îú‚îÄ‚îÄ utils/                       # Utilities
‚îÇ   ‚îú‚îÄ‚îÄ storage.ts               # ‚úÖ Vercel KV adapter
‚îÇ   ‚îú‚îÄ‚îÄ jwt.ts                   # ‚úÖ JWT tokens
‚îÇ   ‚îú‚îÄ‚îÄ panel.ts                 # ‚úÖ 3X-UI API client
‚îÇ   ‚îú‚îÄ‚îÄ logger.ts                # ‚úÖ Structured logging
‚îÇ   ‚îú‚îÄ‚îÄ rate-limit.ts            # ‚úÖ Rate limiting
‚îÇ   ‚îî‚îÄ‚îÄ env-validator.ts         # ‚úÖ ENV validation
‚îÇ
‚îú‚îÄ‚îÄ public/                      # Static files
‚îÇ   ‚îú‚îÄ‚îÄ index.html               # ‚úÖ Landing page + SEO
‚îÇ   ‚îú‚îÄ‚îÄ offer.html               # ‚úÖ –î–æ–≥–æ–≤–æ—Ä –æ—Ñ–µ—Ä—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ privacy.html             # ‚úÖ Privacy policy
‚îÇ   ‚îú‚îÄ‚îÄ success.html             # ‚úÖ –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ webapp.html              # Mini App (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
‚îÇ
‚îú‚îÄ‚îÄ package.json                 # v2.2.0
‚îú‚îÄ‚îÄ vercel.json                  # Vercel config
‚îî‚îÄ‚îÄ tsconfig.json                # TypeScript config
```

---

## üì± USER FLOW

### Trial Flow (3 —à–∞–≥–∞):

```
1. /start –≤ –±–æ—Ç–µ
   ‚Üì
2. –ö–Ω–æ–ø–∫–∞ "üöÄ –ü–û–õ–£–ß–ò–¢–¨ VPN –ë–ï–°–ü–õ–ê–¢–ù–û"
   ‚Üì
3. –õ–µ–Ω–¥–∏–Ω–≥ ‚Üí /api/create-user ‚Üí /api/go/[token]
   ‚Üì
4. Deep link ‚Üí Hiddify/Streisand (–∞–≤—Ç–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
   ‚Üì
5. –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å" –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
```

### Payment Flow:

```
1. –ö–Ω–æ–ø–∫–∞ "üí≥ –û–ü–õ–ê–¢–ò–¢–¨ 99‚ÇΩ/–º–µ—Å—è—Ü"
   ‚Üì
2. –õ–µ–Ω–¥–∏–Ω–≥ —Å action=pay ‚Üí /api/payment/create
   ‚Üì
3. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ YooKassa
   ‚Üì
4. –û–ø–ª–∞—Ç–∞ ‚Üí Webhook ‚Üí –°–æ–∑–¥–∞–Ω–∏–µ —é–∑–µ—Ä–∞
   ‚Üì
5. success.html
```

---

## üîí SECURITY CHECKLIST

| –ü—Ä–æ–≤–µ—Ä–∫–∞                         | –°—Ç–∞—Ç—É—Å |
| -------------------------------- | ------ |
| JWT —Å–µ–∫—Ä–µ—Ç—ã –≤ ENV                | ‚úÖ     |
| Rate limiting (KV)               | ‚úÖ     |
| YooKassa IP verification         | ‚úÖ     |
| Input validation                 | ‚úÖ     |
| Telegram ID –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è trial | ‚úÖ     |
| HTTPS only (Vercel)              | ‚úÖ     |
| No secrets in logs               | ‚úÖ     |
| CORS headers                     | ‚úÖ     |

---

## üìã YOOKASSA COMPLIANCE

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ                  | –°—Ç–∞—Ç—É—Å               |
| --------------------------- | -------------------- |
| –î–æ–≥–æ–≤–æ—Ä –æ—Ñ–µ—Ä—Ç—ã              | ‚úÖ `/offer.html`     |
| –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ | ‚úÖ `/privacy.html`   |
| –†–µ–∫–≤–∏–∑–∏—Ç—ã –ò–ü                | ‚úÖ –ò–ù–ù: 520500573503 |
| –û–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥              | ‚úÖ                   |
| –°—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥             | ‚úÖ 99‚ÇΩ/–º–µ—Å           |
| –£—Å–ª–æ–≤–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞            | ‚úÖ 24 —á–∞—Å–∞           |

---

## ‚ö†Ô∏è –ó–ê–ú–ï–ß–ê–ù–ò–Ø (–Ω–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ)

### 1. webapp.html –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

- –§–∞–π–ª `public/webapp.html` —Å–æ–∑–¥–∞–Ω, –Ω–æ Mini App –æ—Ç–∫–ª—é—á—ë–Ω
- –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –±—É–¥—É—â–µ–≥–æ

### 2. console.log –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ñ–∞–π–ª–∞—Ö

- –û—Å—Ç–∞–ª–∏—Å—å –≤ `bot/webhook.ts`, `payment/webhook.ts`
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `logger`

### 3. rate-limit.ts –≤ payment/create.ts

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç in-memory (–Ω–µ KV)
- –î–ª—è –ø–ª–∞—Ç–µ–∂–µ–π —ç—Ç–æ –¥–æ–ø—É—Å—Ç–∏–º–æ (–Ω–∏–∑–∫–∏–π RPS)

---

## ‚úÖ –ò–¢–û–ì–û–í–´–ô –í–ï–†–î–ò–ö–¢

**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ production! üöÄ**

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç:

- ‚úÖ Telegram –±–æ—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏
- ‚úÖ Trial flow (3 —à–∞–≥–∞)
- ‚úÖ Payment flow —Å YooKassa
- ‚úÖ Rate limiting —á–µ—Ä–µ–∑ Vercel KV
- ‚úÖ YooKassa compliance (–æ—Ñ–µ—Ä—Ç–∞, privacy)
- ‚úÖ SEO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- ‚úÖ Deep links –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º

---

_–ê—É–¥–∏—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω: 18.12.2025 14:44 MSK_
