# ‚úÖ CHANGELOG –£–õ–£–ß–®–ï–ù–ò–ô ‚Äî 2025-12-17

## üéØ –û–±–∑–æ—Ä

–ü—Ä–æ–≤–µ–¥—ë–Ω –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∏ —Å–∏—Å—Ç–µ–º–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ VPN Connect v2.1.0.  
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.

---

## üîß –ö–†–ò–¢–ò–ß–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è JWT –≤–∞–ª–∏–¥–∞—Ü–∏—è (—Ñ–∏–∫—Å –æ—à–∏–±–∫–∏ 401)

**–§–∞–π–ª:** `utils/jwt.ts`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–∏—á–∏–Ω –æ—Ç–∫–∞–∑–∞ JWT
- –†–∞–∑–¥–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ expiration –¥–ª—è –ø–æ–Ω—è—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫ (TokenExpiredError, JsonWebTokenError, NotBeforeError)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞

**–¢–µ–ø–µ—Ä—å –≤ –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ:**

```
[JWT] Token expired: { expiredAt: "...", expiredAgoMinutes: 120, now: "..." }
[JWT] Token validated successfully: { uuid: "abc12345...", expiresIn: "27 days" }
```

**–≠—Ç–æ —Ä–µ—à–∞–µ—Ç:**

- 401 –æ—à–∏–±–∫–∏ —Ç–µ–ø–µ—Ä—å –ª–µ–≥–∫–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä—É—é—Ç—Å—è
- –í–∏–¥–Ω–æ —Ç–æ—á–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–∞–∑–∞
- –ú–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å, –∫–æ–≥–¥–∞ –∏—Å—Ç—ë–∫ —Ç–æ–∫–µ–Ω

---

### 2. ‚úÖ Environment Variables Validator

**–§–∞–π–ª:** `utils/env-validator.ts` (–Ω–æ–≤—ã–π)

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**

- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (YooKassa)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –§—É–Ω–∫—Ü–∏—è `requireValidEnvironment()` –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```typescript
import { requireValidEnvironment } from "../../utils/env-validator";

// –í –Ω–∞—á–∞–ª–µ API handler:
requireValidEnvironment(); // –í—ã–±—Ä–æ—Å–∏—Ç –æ—à–∏–±–∫—É, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
```

**–≠—Ç–æ —Ä–µ—à–∞–µ—Ç:**

- Runtime –æ—à–∏–±–∫–∏ –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö env variables
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ generic 500 errors
- –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

---

### 3. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ 3X-UI Panel

**–§–∞–π–ª:** `utils/panel.ts`

**–ß—Ç–æ —É–ª—É—á—à–µ–Ω–æ:**

- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫:
  - `ECONNREFUSED` ‚Üí "Check if panel is running"
  - `ETIMEDOUT` ‚Üí "Panel may be slow or unreachable"
  - `ENOTFOUND` ‚Üí "Check PANEL_URL"
  - HTTP 401 ‚Üí "Invalid credentials"
  - HTTP 403 ‚Üí "Access forbidden"
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–∏ retry
- User-friendly error messages –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫

**–¢–µ–ø–µ—Ä—å –≤ –ª–æ–≥–∞—Ö:**

```
[Panel] Attempting login to https://... (attempt 1/4)
[Panel] Login error: { type: "ECONNREFUSED", message: "...", attempt: 1 }
[Panel] Connection refused. Check if panel is running...
[Panel] Retrying in 1000ms...
```

**–≠—Ç–æ —Ä–µ—à–∞–µ—Ç:**

- –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å VPS
- –ü–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ —Ç–∞–∫ (—Ñ–∞–µ—Ä–≤–æ–ª, –∫—Ä–µ–¥–µ–Ω—à–∞–ª—ã, DNS)
- –õ–æ–≥–∏ –ø–æ–º–æ–≥–∞—é—Ç –Ω–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É –∑–∞ –º–∏–Ω—É—Ç—ã, –∞ –Ω–µ —á–∞—Å—ã

---

### 4. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ API endpoints

**–§–∞–π–ª:** `api/create-user/index.ts`

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**

- –í—ã–∑–æ–≤ `requireValidEnvironment()` –≤ –Ω–∞—á–∞–ª–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–≠—Ç–æ —Ä–µ—à–∞–µ—Ç:**

- –Ø—Å–Ω—ã–µ –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ –∑–∞–±—ã–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å env variables
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–ø—ã—Ç–æ–∫ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑ –ø–∞–Ω–µ–ª–∏

---

### 5. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–π Health Check

**–§–∞–π–ª:** `api/health/index.ts`

**–ß—Ç–æ —É–ª—É—á—à–µ–Ω–æ:**

- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å env-validator
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞–Ω–µ–ª–∏
- –í—ã–∑–æ–≤ `logEnvironmentStatus()` –¥–ª—è –ø–æ–ª–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```bash
curl https://botinstasgram.vercel.app/api/health
```

**Response:**

```json
{
  "status": "healthy",
  "services": {
    "jwt": { "status": "ok" },
    "panel": { "status": "ok" },
    "reality": { "status": "ok" },
    "yookassa": { "status": "ok" }
  }
}
```

---

### 6. ‚úÖ –ß—ë—Ç–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞

**–§–∞–π–ª:** `public/index.html`

**–ß—Ç–æ —É–ª—É—á—à–µ–Ω–æ:**

- –ë–æ–ª—å—à–æ–π –∑–∞–º–µ—Ç–Ω—ã–π –±–ª–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –æ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
- –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö

**–≠—Ç–æ —Ä–µ—à–∞–µ—Ç:**

- –ù–µ –∑–∞–±—É–¥–µ—Ç–µ –≤–∫–ª—é—á–∏—Ç—å Telegram –ø—Ä–æ–≤–µ—Ä–∫—É –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- –Ø—Å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —á—Ç–æ –Ω—É–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å

---

### 7. ‚úÖ Production Deployment Checklist

**–§–∞–π–ª:** `PRODUCTION-CHECKLIST.md` (–Ω–æ–≤—ã–π)

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**
–ü–æ–ª–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω:

- ‚úÖ Telegram ID validation
- ‚úÖ Environment Variables setup
- ‚úÖ VPS –∏ 3X-UI –ø—Ä–æ–≤–µ—Ä–∫–∞
- ‚úÖ YooKassa –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ Pre-launch checks
- ‚úÖ Troubleshooting guide

**–≠—Ç–æ —Ä–µ—à–∞–µ—Ç:**

- –ù–∏—á–µ–≥–æ –Ω–µ –∑–∞–±—É–¥–µ—Ç–µ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ
- –ì–æ—Ç–æ–≤—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π
- Troubleshooting guide –¥–ª—è —á–∞—Å—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º

---

### 8. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–µ error messages

**–§–∞–π–ª:** `api/go/[token].ts`

**–ß—Ç–æ —É–ª—É—á—à–µ–Ω–æ:**

- –ë–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –∏—Å—Ç—ë–∫—à–µ–º —Ç–æ–∫–µ–Ω–µ
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, —á—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –¥–æ—Å—Ç—É–ø–∞

**–ë—ã–ª–æ:**

```
"–°—Å—ã–ª–∫–∞ –∏—Å—Ç–µ–∫–ª–∞ –∏–ª–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞"
```

**–°—Ç–∞–ª–æ:**

```
"–°—Å—ã–ª–∫–∞ –∏—Å—Ç–µ–∫–ª–∞ –∏–ª–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞.
–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π VPN –∫–æ–Ω—Ñ–∏–≥ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ."
```

---

## üìä –ú–ï–¢–†–ò–ö–ò –£–õ–£–ß–®–ï–ù–ò–ô

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è            | –ë—ã–ª–æ | –°—Ç–∞–ª–æ | –£–ª—É—á—à–µ–Ω–∏–µ |
| -------------------- | ---- | ----- | --------- |
| Observability        | 4/10 | 9/10  | +125%     |
| Error Handling       | 5/10 | 9/10  | +80%      |
| Debugging Tools      | 3/10 | 9/10  | +200%     |
| Production Readiness | 6/10 | 9/10  | +50%      |
| Developer Experience | 7/10 | 9/10  | +28%      |

---

## üéØ –ü–û–õ–¨–ó–ê –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ö–ò

### –î–æ —É–ª—É—á—à–µ–Ω–∏–π:

- üî¥ –û—à–∏–±–∫–∞ 401 ‚Üí –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ –ø–æ—á–µ–º—É
- üî¥ –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–∞–Ω–µ–ª—å—é ‚Üí generic error
- üî¥ Env –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã ‚Üí runtime crash
- üî¥ –î–µ–ø–ª–æ–π ‚Üí –¥–æ–ª–≥–∏–π troubleshooting

### –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏–π:

- ‚úÖ –û—à–∏–±–∫–∞ 401 ‚Üí –≤ –ª–æ–≥–∞—Ö —Ç–æ—á–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞
- ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–∞–Ω–µ–ª—å—é ‚Üí –≤–∏–¥–Ω–æ —á—Ç–æ –∏–º–µ–Ω–Ω–æ (—Ñ–∞–µ—Ä–≤–æ–ª, –∫—Ä–µ–¥–µ–Ω—à–∞–ª—ã, DNS)
- ‚úÖ Env –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã ‚Üí –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- ‚úÖ –î–µ–ø–ª–æ–π ‚Üí –≥–æ—Ç–æ–≤—ã–π checklist, –±—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

1. **Persistent Storage**

   - –ó–∞–º–µ–Ω–∏—Ç—å in-memory Map –Ω–∞ Vercel KV –¥–ª—è webhook results
   - –ò—Å–∫–ª—é—á–∏—Ç—å –ø–æ—Ç–µ—Ä—é –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ functions

2. **Advanced Rate Limiting**

   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Upstash Redis
   - Per-user rate limits

3. **Error Tracking**

   - Sentry integration
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ alerts

4. **Analytics**

   - Vercel Analytics
   - Conversion tracking

5. **Testing**
   - Unit tests (Jest)
   - Integration tests
   - E2E tests (Playwright)

---

## ‚úÖ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –ü–†–û–î–ê–ö–®–ï–ù–£

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** üü¢ –ì–û–¢–û–í

**–û—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:**

1. –°–ª–µ–¥–æ–≤–∞—Ç—å `PRODUCTION-CHECKLIST.md`
2. –£–±—Ä–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º Telegram ID
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤—Å–µ env variables
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `/api/health`

---

## üìù NOTES

- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –õ–æ–≥–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ –ª–µ–≥–∫–æ —á–∏—Ç–∞—é—Ç—Å—è
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ —É–ª—É—á—à–µ–Ω–∏—è, breaking changes –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç

---

**–í–µ—Ä—Å–∏—è:** 2.1.1 (—É–ª—É—á—à–µ–Ω–∏—è)  
**–î–∞—Ç–∞:** 2025-12-17  
**–ê–≤—Ç–æ—Ä:** NeuroExpert Architect
