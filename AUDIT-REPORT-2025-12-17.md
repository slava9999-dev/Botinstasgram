# üöÄ –ê–£–î–ò–¢-–û–¢–ß–Å–¢ v2.1.1 ‚Äî –§–ò–ù–ê–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø

**–î–∞—Ç–∞:** 17 –¥–µ–∫–∞–±—Ä—è 2025  
**–ê—É–¥–∏—Ç–æ—Ä:** Lead Developer (NeuroExpert Architect)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ì–û–¢–û–í –ö –ü–†–û–î–ê–ö–®–ï–ù–£** (–ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ VPS)

---

## üìä –ò–¢–û–ì–û–í–û–ï –°–û–°–¢–û–Ø–ù–ò–ï

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç              | –°—Ç–∞—Ç—É—Å     | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ             |
| ---------------------- | ---------- | ---------------------- |
| **Backend API**        | ‚úÖ 100%    | –í—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç |
| **Frontend UI**        | ‚úÖ 100%    | –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω      |
| **JWT Auth**           | ‚úÖ 100%    | Stateless —Ç–æ–∫–µ–Ω—ã       |
| **Payment (YooKassa)** | ‚úÖ 100%    | Create + Webhook       |
| **Rate Limiting**      | ‚úÖ 100%    | In-memory + KV ready   |
| **Trial Logic**        | ‚úÖ 100%    | expiryTime –∏—Å–ø—Ä–∞–≤–ª–µ–Ω   |
| **Telegram Bot**       | ‚úÖ 100%    | Webhook –≥–æ—Ç–æ–≤          |
| **Documentation**      | ‚úÖ 100%    | –ü–æ–ª–Ω–∞—è                 |
| **VPS/3X-UI**          | ‚ö†Ô∏è Pending | –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS  |

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û –í –≠–¢–û–ú –ê–£–î–ò–¢–ï

### 1. **expiryTime ‚Äî –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï**

**–§–∞–π–ª:** `utils/panel.ts`

**–ë—ã–ª–æ (–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ö–∞–∫):**

```typescript
const expiryTime = 0; // Unlimited for now
```

**–°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞):**

```typescript
const expiryTime =
  totalDays > 0 ? Date.now() + totalDays * 24 * 60 * 60 * 1000 : 0;
```

‚úÖ Trial (3 –¥–Ω—è) –∏ –ø–ª–∞—Ç–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è.

---

### 2. **Telegram Support ‚Äî Placeholder –∑–∞–º–µ–Ω—ë–Ω**

**–§–∞–π–ª:** `api/bot/webhook.ts`

**–ë—ã–ª–æ:**

```typescript
`<b>–ü–æ–¥–¥–µ—Ä–∂–∫–∞:</b> @your_support_username`;
```

**–°—Ç–∞–ª–æ:**

```typescript
`<b>–ü–æ–¥–¥–µ—Ä–∂–∫–∞:</b> @vpn_connect_support`;
```

---

### 3. **Constants ‚Äî –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ**

**–§–∞–π–ª:** `utils/constants.ts`

- ‚úÖ `TRIAL_CONFIG` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–±–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
- ‚úÖ `TELEGRAM_CONFIG` ‚Äî –∫–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- ‚úÖ `CLIENT_APPS` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å—Å—ã–ª–∫–∏ –Ω–∞ Hiddify/FoXray
- ‚úÖ `ERROR_CODES` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã Trial –∏ Telegram –∫–æ–¥—ã

---

### 4. **Storage Module ‚Äî Vercel KV Ready**

**–§–∞–π–ª:** `utils/storage.ts` (–ù–û–í–´–ô)

–°–æ–∑–¥–∞–Ω —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å —Ö—Ä–∞–Ω–µ–Ω–∏—è:

- `PaymentStorage` ‚Äî –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
- `RateLimitStorage` ‚Äî –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π rate limiting
- `TrialStorage` ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ trial
- `Cache` ‚Äî –æ–±—â–∏–π –∫—ç—à

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Vercel KV –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω, –∏–Ω–∞—á–µ in-memory fallback.

---

### 5. **Health Check ‚Äî –†–∞—Å—à–∏—Ä–µ–Ω**

**–§–∞–π–ª:** `api/health/index.ts`

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞:

- ‚úÖ Storage status (Vercel KV / in-memory)
- ‚úÖ Latency measurement

---

### 6. **VPS Setup Guide ‚Äî –°–æ–∑–¥–∞–Ω**

**–§–∞–π–ª:** `VPS-SETUP-GUIDE.md` (–ù–û–í–´–ô)

–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ:

- DNS –≤ 3X-UI
- Routing –ø—Ä–∞–≤–∏–ª–∞
- Firewall –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç—Ä–∞—Ñ–∏–∫–∞

---

## üìÅ –ù–û–í–´–ï –§–ê–ô–õ–´

| –§–∞–π–ª                            | –û–ø–∏—Å–∞–Ω–∏–µ                 |
| ------------------------------- | ------------------------ |
| `utils/storage.ts`              | –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –Ω–∞–¥ Vercel KV |
| `utils/constants.production.ts` | Production –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã     |
| `VPS-SETUP-GUIDE.md`            | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ VPS |

---

## üî¥ –û–°–¢–ê–í–®–ò–ï–°–Ø –ó–ê–î–ê–ß–ò

### **–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞ VPS (–Ω–µ –≤ –∫–æ–¥–µ):**

1. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å DNS** –≤ 3X-UI:

   ```json
   { "dns": { "servers": ["1.1.1.1", "8.8.8.8"] } }
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å routing** ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `direct` outbound

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å firewall** ‚Äî –ø–æ—Ä—Ç 443 –æ—Ç–∫—Ä—ã—Ç

4. **–í–∫–ª—é—á–∏—Ç—å IP Forwarding**:
   ```bash
   echo 1 > /proc/sys/net/ipv4/ip_forward
   ```

### **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (—É–ª—É—á—à–µ–Ω–∏—è):**

- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å Vercel KV –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ storage
- [ ] –î–æ–±–∞–≤–∏—Ç—å Sentry –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—à–∏–±–æ–∫
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π username –±–æ—Ç–∞ –≤ Telegram

---

## üéØ CHECKLIST –ü–ï–†–ï–î –ó–ê–ü–£–°–ö–û–ú

### –ö–æ–¥ ‚úÖ –ì–û–¢–û–í:

- [x] expiryTime –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- [x] Telegram ID –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Rate limiting –∞–∫—Ç–∏–≤–µ–Ω
- [x] Health check —Ä–∞—Å—à–∏—Ä–µ–Ω
- [x] TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢ –ù–ê–°–¢–†–û–ô–ö–ò:

- [ ] DNS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ 3X-UI
- [ ] VPN —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è)
- [ ] –¢–µ—Å—Ç –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö (iOS/Android)

---

## üìû –ö–û–ú–ê–ù–î–´ –î–ï–ü–õ–û–Ø

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥
npm run type-check

# 2. –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
git add -A
git commit -m "üöÄ Production ready v2.1.1: fixed expiryTime, added storage module"

# 3. Push (–∞–≤—Ç–æ-–¥–µ–ø–ª–æ–π –≤ Vercel)
git push origin main

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health
curl https://botinstasgram.vercel.app/api/health
```

---

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:** –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É. –ì–ª–∞–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å VPS –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞.

---

**–í–µ—Ä—Å–∏—è:** 2.1.1  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 17 –¥–µ–∫–∞–±—Ä—è 2025  
**–ê–≤—Ç–æ—Ä:** Lead Developer
